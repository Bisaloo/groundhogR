<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>groundhog • groundhog</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="groundhog">
<meta property="og:description" content="groundhog">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">groundhog</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/groundhog.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CredibilityLab/groundhog/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="groundhog_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>groundhog</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CredibilityLab/groundhog/blob/master/vignettes/groundhog.Rmd"><code>vignettes/groundhog.Rmd</code></a></small>
      <div class="hidden name"><code>groundhog.Rmd</code></div>

    </div>

    
    
<div id="front-end-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#front-end-overview" class="anchor"></a>Front-end overview</h1>
<p>The function <code><a href="../reference/groundhog.library.html">groundhog.library()</a></code> substitutes the functions: <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> and <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>.</p>
<p>In contrast to <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, with <code><a href="../reference/groundhog.library.html">groundhog.library()</a></code></p>
<ul>
<li>A date must be included within the <code><a href="../reference/groundhog.library.html">groundhog.library()</a></code> command</li>
<li>The version of the package available on that day, is automatically installed if needed</li>
<li>All dependencies for that package are installed as available that day.</li>
</ul>
<p>groundhog allows having multiple (possibly all) versions of a package available, and loading whichever one is wanted. For an older project you work with an older version of a package to ensure reproducibility, while for a new project you work with a newer version.</p>
<p>For example, to work with the package rio as it was available on 2017-09-15 instead of</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"rio"</span><span class="op">)</span></pre></div>
<p>you run</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="../reference/groundhog.library.html">groundhog.library</a></span><span class="op">(</span><span class="st">"rio"</span>, <span class="st">"2017-09-15"</span><span class="op">)</span></pre></div>
<p>Even on the same script (<code>.R</code> file) you can switch which version you use, like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="../reference/groundhog.library.html">groundhog.library</a></span><span class="op">(</span><span class="st">"rio"</span>, <span class="st">"2019-01-27"</span><span class="op">)</span></pre></div>
</div>
<div id="recommended-uses" class="section level1">
<h1 class="hasAnchor">
<a href="#recommended-uses" class="anchor"></a>Recommended uses</h1>
<div id="use-1-writing-new-r-scripts" class="section level2">
<h2 class="hasAnchor">
<a href="#use-1-writing-new-r-scripts" class="anchor"></a>USE 1: Writing new R scripts</h2>
<p>When working on new scripts, unless you have a reason not to, choose a date for the whole script and stick to it. Maybe the date when the project was started. It makes sense to set the date as a variable you can call though your script. You can give that variable any name, perhaps <code>groundhog.day</code> makes sense.</p>
<p>So the top of your reproducible R scripts will look something like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co">####   Written in R Version 3.6.1 - ####</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://groundhogr.com/">"groundhog"</a></span><span class="op">)</span>

<span class="va">groundhog.date</span> <span class="op">&lt;-</span> <span class="st">"2019-04-21"</span>
<span class="fu"><a href="../reference/groundhog.library.html">groundhog.library</a></span><span class="op">(</span><span class="st">"rio"</span>, date <span class="op">=</span> <span class="va">groundhog.day</span><span class="op">)</span>
<span class="fu"><a href="../reference/groundhog.library.html">groundhog.library</a></span><span class="op">(</span><span class="st">"pwr"</span>, date <span class="op">=</span> <span class="va">groundhog.day</span><span class="op">)</span>

<span class="co"># &lt;your code&gt;</span></pre></div>
</div>
<div id="use-2-revive-existing-scripts" class="section level2">
<h2 class="hasAnchor">
<a href="#use-2-revive-existing-scripts" class="anchor"></a>USE 2: Revive existing scripts</h2>
<p>The whole reason for groundhog to exist is that packages change over time in ways that make old scripts not work. A likely use of groundhog is thus to revive old scripts that no longer work.</p>
<p>To recover a non-working script replace its <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> statements, with <code><a href="../reference/groundhog.library.html">groundhog.library()</a></code> ones, trying older dates until the script works again.</p>
<p>You can start setting the date to the date when the script you are reviving was last saved. If that does not work, roll back the clock further (and possibly separately for each package in the script).</p>
<p>This process is facilitated by knowing when a package had a version change. Use <code><a href="../reference/toc.html">groundhog::toc()</a></code> to get the table of contents, like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu">groundhog</span><span class="fu">::</span><span class="fu"><a href="../reference/toc.html">toc</a></span><span class="op">(</span><span class="st">"rio"</span><span class="op">)</span>
<span class="fu">groundhog</span><span class="fu">::</span><span class="fu"><a href="../reference/toc.html">toc</a></span><span class="op">(</span><span class="st">"pwr"</span><span class="op">)</span></pre></div>
<p>To get a single set with all relevant changes worth trying:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu">groundhog</span><span class="fu">::</span><span class="fu"><a href="../reference/cross.toc.html">cross.toc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rio"</span>, <span class="st">"pwr"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="use-3-document-changes-in-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#use-3-document-changes-in-packages" class="anchor"></a>USE 3: Document changes in packages</h2>
<p>To explain an error in a paper, or document the introduction of a new feature, etc., it may be useful to run within the same script the same code for two versions of the same package.</p>
<p>For example, one may run some commands with one version of a package and later with a different version (useful for debugging and explaining errors caused by package changes).</p>
<p>If an older version of a package is not compatible with a newer version of R, the needed version of R will be indicated. The user can install it and run the same script on it.</p>
<p>Note that RStudio can manage multiple versions of R and users select the desired one when starting RStudio.</p>
<p><pending>: want to create the command changeR() which will switch the version of R being used</pending></p>
</div>
</div>
<div id="back-end" class="section level1">
<h1 class="hasAnchor">
<a href="#back-end" class="anchor"></a>Back end</h1>
<p>Two key design features that enable groundhog to maintain multiple versions of the same package within the same R installation, and calling specific versions on the spot:</p>
<ol style="list-style-type: decimal">
<li>Richer directory structure for the library of packages, and</li>
<li>Dynamically generated search path of packages modified with each <code><a href="../reference/groundhog.library.html">groundhog.library()</a></code> call.</li>
</ol>
<div id="directory-structure-" class="section level2">
<h2 class="hasAnchor">
<a href="#directory-structure-" class="anchor"></a>Directory structure.</h2>
<p>With base R, there is a single library folder with package names (without indicating version) as subfolders. Those subfolders contain only the latest installed version of the corresponding package, and the files are deleted and replaced when a package gets updated. <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>groundhog, instead, gives a different subfolder to each package version. When a new version is installed, it is stored in a new subfolder, keeping all existing ones unchanged.</p>
<p>So for example, in base R, the package rio 0.5.1 is stored here</p>
<pre><code>C:\Users\mike\Documents\R\win-library\3.6\Rio</code></pre>
<p>While in groundhog it is stored <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<pre><code>C:\Users\mike\Documents\groundhog\R-3.6\rio_0.5.1</code></pre>
<p>So while when with base R rio is updated, the same folder now has different contents</p>
<pre><code>C:\Users\mike\Documents\R\win-library\3.6\Rio</code></pre>
<p>With groundhog a new folder is added, keeping both versions available:</p>
<pre><code>C:\Users\mike\Documents\groundhog\R-3.6\rio_0.5.2
C:\Users\mike\Documents\groundhog\R-3.6\rio_0.5.1</code></pre>
</div>
<div id="dynamic-search-path" class="section level2">
<h2 class="hasAnchor">
<a href="#dynamic-search-path" class="anchor"></a>Dynamic search path</h2>
<p>The <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> command in R uses the <code><a href="https://rdrr.io/r/base/libPaths.html">.libPaths()</a></code> path to search for installed packages. That path is stable for all <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> calls (but can be modified by users).</p>
<p><code><a href="../reference/groundhog.library.html">groundhog.library()</a></code>, in contrast, uses changes the searchpath for every call, so as to find the right version of the package for the date indicated, and R version being used.</p>
<p>For instance, <code><a href="../reference/groundhog.library.html">groundhog.library("rio", "2017-10-11")</a></code> will find the version of rio for that, date, and all the dependencies for rio for that date, and add the path to each specific needed version to the search path, so that R uses the corresponding version</p>
</div>
</div>
<div id="comparison-to-checkpoint" class="section level1">
<h1 class="hasAnchor">
<a href="#comparison-to-checkpoint" class="anchor"></a>Comparison to checkpoint</h1>
<p>The checkpoint package is offered by Microsoft to enable reproducible R Code relying on Microsoft’s MRAN archive (with daily copies of every file on CRAN, starting in late 2014). <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p>groundhog is thus a substitute for checkpoint. This section discusses feature of checkpoint that were deemed undesirable and which are absent from groundhog</p>
<ol style="list-style-type: decimal">
<li>
<p>Lack of feedback on errors to debug</p>
<p>When checkpoint fails to install a package it does not provide feedback on how to correct the problem. For example, the package igraph_0.7 (with over 500 reverse dependencies), will not install in R version 3.5.0 or higher. To run a script that depends on it, one must use an older versions of R which will allow igraph 0.7 to be installed.</p>
<p>But, the only feedback checkpoint provides a user that attempts to install igraph 0.7 in a newer version of R is that the package failed to load (and therefore so would the 500+ packages that depend on it, or those that depend on those packages, etc.).</p>
<p>groundhog tells users which R version is needed to run igraph 0.7 (or any package that fails to install), and gives instructions for installing and running older R.</p>
</li>
<li>
<p>Multiple identical installations</p>
<p>checkpoint starts an empty package library for every project, leading to new installations of every package needed for every project. If the same package is used for 20 scripts, it is installed 20 times byccheckpoint, and 20 copies are permanently stored.</p>
<p>groundhog uses a single comprehensive library that has no duplicate package installs.</p>
</li>
<li>
<p>Script flow</p>
<p>For checkpoint to run, scripts must be kept in a project folder, and be already saved there.</p>
<p>So, e.g., if a user starts a new script without saving it in an existing project, checkpoint will not work.</p>
<p>When the date for checkpoint is changed, all scripts in that project will reinstall and all packages for that new date (even if the new date leads to the same package being downloaded and installed again). From that point onwards users can use <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> and they will use the previously chosen date, but this is not self-evident from the command itself, and if a line of code is skipped, or a file was not saved, a different package may be installed, in ways that are not traceable. Mistakes seem likely.</p>
</li>
<li>
<p>No packages before 2014</p>
<p>Checkpoint relies exclusively on MRAN, which started in late 2014. No earlier packages can be installed to render old scripts reproducible. groundhog uses the CRAN archive of source files to access any CRAN package ever available.</p>
</li>
<li>
<p>Difficult to debug non-working scripts.</p>
<p>If an existing script does work due to backwards incompatibility of a required package, and the date when the packages used in that script is unknown (a likely scenario), one can try to revive the script by trying alternative install dates for each of the packages, but this is not possible with checkpoint, as all packages share the same date. In addition, changing the date to debug one package will lead to reinstalling all packages in any script in that project. Thus every date attempted could lead to several minutes of installation time before anything can be attempted.</p>
</li>
</ol>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>It is possible to have multiple libraries with base R, and many users do without awareness have more than one attached in <code><a href="https://rdrr.io/r/base/libPaths.html">.libPaths()</a></code>. In practice, users tend to install all packages in the same library. More importantly, the name of subfolders in base R is just the name of the package, while in groundhog it is the name and version combined: <code>package_version</code>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Note then, that there is a parent directory with the R version for which the package was installed. So there could also be a <code>C:\Users\mike\Documents\groundhog\R-3.6\rio_0.5.1</code> and a <code>C:\Users\mike\Documents\groundhog\R-3.5\rio_0.5.1</code>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>I have learned that there are several individual days missing from the MRAN archive, it is not literally every day.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Uri Simonsohn, <a href="https://normalesup.org/~hgruson">Hugo Gruson</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
